[
  {
    "fixtureFile": "tests/fixtures/batteryPack/v1/cases/office_tou_with_demand.json",
    "expected": {
      "batteryOpportunityV1": {
        "recommendedPowerKwRange": [3, 7.5],
        "recommendedEnergyKwhRange": [9, 30],
        "valueDrivers": ["TOU_ARBITRAGE", "DEMAND_PEAK_SHAVE", "LOAD_SHIFT"],
        "confidenceTier": "NONE",
        "warnings": [],
        "missingInfo": [],
        "savingsTotal": { "min": 1686.883333, "max": 1686.883333, "method": "battery_total_savings_hybrid_v1" }
      },
      "dispatchSimulationV1": {
        "strategyOrder": ["PEAK_SHAVE_DAILY_V1", "TOU_SHIFT_V1", "HYBRID_V1"],
        "strategyMethods": [
          { "strategyId": "PEAK_SHAVE_DAILY_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "TOU_SHIFT_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "HYBRID_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" }
        ],
        "warnings": []
      },
      "drReadinessV1": {
        "topEventWindowsCount": 1,
        "topEventWindowsTop3": [{ "dateIso": "2026-01-05", "startHourLocal": 8, "durationHours": 2 }],
        "typicalShedPotentialKwRange": [15, 15],
        "variabilityScore": { "value": 0, "method": "dr_variability_cv_v1" },
        "confidenceTier": "NONE",
        "warnings": ["dr.v1.insufficient_coverage"],
        "missingInfo": []
      }
    }
  },
  {
    "fixtureFile": "tests/fixtures/batteryPack/v1/cases/office_tou_no_demand.json",
    "expected": {
      "batteryOpportunityV1": {
        "recommendedPowerKwRange": [3, 7.5],
        "recommendedEnergyKwhRange": [9, 30],
        "valueDrivers": ["TOU_ARBITRAGE", "LOAD_SHIFT"],
        "confidenceTier": "NONE",
        "warnings": [],
        "missingInfo": ["battery.v1.missing_demand_determinants"],
        "savingsTotal": { "min": 489.883333, "max": 489.883333, "method": "battery_total_savings_hybrid_v1" }
      },
      "dispatchSimulationV1": {
        "strategyOrder": ["PEAK_SHAVE_DAILY_V1", "TOU_SHIFT_V1", "HYBRID_V1"],
        "strategyMethods": [
          { "strategyId": "PEAK_SHAVE_DAILY_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "TOU_SHIFT_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "HYBRID_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" }
        ],
        "warnings": ["battery.v1.missing_demand_determinants"]
      },
      "drReadinessV1": {
        "topEventWindowsCount": 1,
        "topEventWindowsTop3": [{ "dateIso": "2026-01-05", "startHourLocal": 8, "durationHours": 2 }],
        "typicalShedPotentialKwRange": [15, 15],
        "variabilityScore": { "value": 0, "method": "dr_variability_cv_v1" },
        "confidenceTier": "NONE",
        "warnings": ["dr.v1.insufficient_coverage"],
        "missingInfo": []
      }
    }
  },
  {
    "fixtureFile": "tests/fixtures/batteryPack/v1/cases/flat_baseload_no_tariff.json",
    "expected": {
      "batteryOpportunityV1": {
        "recommendedPowerKwRange": [0, 0],
        "recommendedEnergyKwhRange": [0, 0],
        "valueDrivers": ["LOAD_SHIFT"],
        "confidenceTier": "NONE",
        "warnings": [],
        "missingInfo": ["battery.v1.missing_demand_determinants", "battery.v1.missing_tariff_prices"],
        "savingsTotal": { "min": 0, "max": 0, "method": "battery_total_savings_hybrid_v1" }
      },
      "dispatchSimulationV1": {
        "strategyOrder": ["PEAK_SHAVE_DAILY_V1", "TOU_SHIFT_V1", "HYBRID_V1"],
        "strategyMethods": [
          { "strategyId": "PEAK_SHAVE_DAILY_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "TOU_SHIFT_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "HYBRID_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" }
        ],
        "warnings": ["battery.v1.missing_demand_determinants", "battery.v1.missing_tariff_prices"]
      },
      "drReadinessV1": {
        "topEventWindowsCount": 1,
        "topEventWindowsTop3": [{ "dateIso": "2026-01-02", "startHourLocal": 0, "durationHours": 2 }],
        "typicalShedPotentialKwRange": [0, 0],
        "variabilityScore": { "value": 0, "method": "dr_variability_cv_v1" },
        "confidenceTier": "NONE",
        "warnings": ["dr.v1.insufficient_coverage"],
        "missingInfo": []
      }
    }
  },
  {
    "fixtureFile": "tests/fixtures/batteryPack/v1/cases/weekend_heavy_tou.json",
    "expected": {
      "batteryOpportunityV1": {
        "recommendedPowerKwRange": [1, 2.5],
        "recommendedEnergyKwhRange": [3, 10],
        "valueDrivers": ["TOU_ARBITRAGE", "LOAD_SHIFT"],
        "confidenceTier": "LOW",
        "warnings": [],
        "missingInfo": ["battery.v1.missing_demand_determinants"],
        "savingsTotal": { "min": 163.294444, "max": 163.294444, "method": "battery_total_savings_hybrid_v1" }
      },
      "dispatchSimulationV1": {
        "strategyOrder": ["PEAK_SHAVE_DAILY_V1", "TOU_SHIFT_V1", "HYBRID_V1"],
        "strategyMethods": [
          { "strategyId": "PEAK_SHAVE_DAILY_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "TOU_SHIFT_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "HYBRID_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" }
        ],
        "warnings": ["battery.v1.missing_demand_determinants"]
      },
      "drReadinessV1": {
        "topEventWindowsCount": 2,
        "topEventWindowsTop3": [
          { "dateIso": "2026-01-03", "startHourLocal": 11, "durationHours": 2 },
          { "dateIso": "2026-01-02", "startHourLocal": 0, "durationHours": 2 }
        ],
        "typicalShedPotentialKwRange": [0, 0],
        "variabilityScore": { "value": 1, "method": "dr_variability_cv_v1" },
        "confidenceTier": "NONE",
        "warnings": ["dr.v1.insufficient_coverage"],
        "missingInfo": []
      }
    }
  },
  {
    "fixtureFile": "tests/fixtures/batteryPack/v1/cases/kw_only_tou.json",
    "expected": {
      "batteryOpportunityV1": {
        "recommendedPowerKwRange": [0, 0],
        "recommendedEnergyKwhRange": [0, 0],
        "valueDrivers": ["TOU_ARBITRAGE", "LOAD_SHIFT"],
        "confidenceTier": "NONE",
        "warnings": [],
        "missingInfo": ["battery.v1.missing_demand_determinants"],
        "savingsTotal": { "min": 0, "max": 0, "method": "battery_total_savings_hybrid_v1" }
      },
      "dispatchSimulationV1": {
        "strategyOrder": ["PEAK_SHAVE_DAILY_V1", "TOU_SHIFT_V1", "HYBRID_V1"],
        "strategyMethods": [
          { "strategyId": "PEAK_SHAVE_DAILY_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "TOU_SHIFT_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "HYBRID_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" }
        ],
        "warnings": ["battery.v1.missing_demand_determinants"]
      },
      "drReadinessV1": {
        "topEventWindowsCount": 1,
        "topEventWindowsTop3": [{ "dateIso": "2026-01-09", "startHourLocal": 0, "durationHours": 2 }],
        "typicalShedPotentialKwRange": [0, 0],
        "variabilityScore": { "value": 0, "method": "dr_variability_cv_v1" },
        "confidenceTier": "NONE",
        "warnings": ["dr.v1.insufficient_coverage"],
        "missingInfo": []
      }
    }
  },
  {
    "fixtureFile": "tests/fixtures/batteryPack/v1/cases/large_gaps_tou.json",
    "expected": {
      "batteryOpportunityV1": {
        "recommendedPowerKwRange": [0, 0],
        "recommendedEnergyKwhRange": [0, 0],
        "valueDrivers": ["TOU_ARBITRAGE", "LOAD_SHIFT"],
        "confidenceTier": "NONE",
        "warnings": [],
        "missingInfo": ["battery.v1.missing_demand_determinants"],
        "savingsTotal": { "min": 0, "max": 0, "method": "battery_total_savings_hybrid_v1" }
      },
      "dispatchSimulationV1": {
        "strategyOrder": ["PEAK_SHAVE_DAILY_V1", "TOU_SHIFT_V1", "HYBRID_V1"],
        "strategyMethods": [
          { "strategyId": "PEAK_SHAVE_DAILY_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "TOU_SHIFT_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "HYBRID_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" }
        ],
        "warnings": ["battery.v1.missing_demand_determinants"]
      },
      "drReadinessV1": {
        "topEventWindowsCount": 1,
        "topEventWindowsTop3": [{ "dateIso": "2026-01-06", "startHourLocal": 0, "durationHours": 2 }],
        "typicalShedPotentialKwRange": [0, 0],
        "variabilityScore": { "value": 0, "method": "dr_variability_cv_v1" },
        "confidenceTier": "NONE",
        "warnings": ["dr.v1.insufficient_coverage"],
        "missingInfo": []
      }
    }
  },
  {
    "fixtureFile": "tests/fixtures/batteryPack/v1/cases/dst_boundary_tou.json",
    "expected": {
      "batteryOpportunityV1": {
        "recommendedPowerKwRange": [0, 0],
        "recommendedEnergyKwhRange": [0, 0],
        "valueDrivers": ["TOU_ARBITRAGE", "LOAD_SHIFT"],
        "confidenceTier": "NONE",
        "warnings": [],
        "missingInfo": ["battery.v1.missing_demand_determinants"],
        "savingsTotal": { "min": 0, "max": 0, "method": "battery_total_savings_hybrid_v1" }
      },
      "dispatchSimulationV1": {
        "strategyOrder": ["PEAK_SHAVE_DAILY_V1", "TOU_SHIFT_V1", "HYBRID_V1"],
        "strategyMethods": [
          { "strategyId": "PEAK_SHAVE_DAILY_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "TOU_SHIFT_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "HYBRID_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" }
        ],
        "warnings": ["battery.v1.missing_demand_determinants"]
      },
      "drReadinessV1": {
        "topEventWindowsCount": 1,
        "topEventWindowsTop3": [{ "dateIso": "2026-03-08", "startHourLocal": 0, "durationHours": 2 }],
        "typicalShedPotentialKwRange": [0, 0],
        "variabilityScore": { "value": 0, "method": "dr_variability_cv_v1" },
        "confidenceTier": "NONE",
        "warnings": ["dr.v1.insufficient_coverage"],
        "missingInfo": []
      }
    }
  },
  {
    "fixtureFile": "tests/fixtures/batteryPack/v1/cases/non_uniform_granularity_tou.json",
    "expected": {
      "batteryOpportunityV1": {
        "recommendedPowerKwRange": [0, 0],
        "recommendedEnergyKwhRange": [0, 0],
        "valueDrivers": ["TOU_ARBITRAGE", "LOAD_SHIFT"],
        "confidenceTier": "NONE",
        "warnings": [],
        "missingInfo": ["battery.v1.missing_demand_determinants"],
        "savingsTotal": { "min": 0, "max": 0, "method": "battery_total_savings_hybrid_v1" }
      },
      "dispatchSimulationV1": {
        "strategyOrder": ["PEAK_SHAVE_DAILY_V1", "TOU_SHIFT_V1", "HYBRID_V1"],
        "strategyMethods": [
          { "strategyId": "PEAK_SHAVE_DAILY_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "TOU_SHIFT_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" },
          { "strategyId": "HYBRID_V1", "peakMethod": "dispatch_peak_kw_reduction_v1", "kwhMethod": "dispatch_shifted_kwh_annual_v1", "energyMethod": "tou_arbitrage_simple_v1", "demandMethod": "demand_charge_simple_monthly_v1" }
        ],
        "warnings": ["battery.v1.missing_demand_determinants"]
      },
      "drReadinessV1": {
        "topEventWindowsCount": 1,
        "topEventWindowsTop3": [{ "dateIso": "2026-01-08", "startHourLocal": 0, "durationHours": 2 }],
        "typicalShedPotentialKwRange": [0, 0],
        "variabilityScore": { "value": 0, "method": "dr_variability_cv_v1" },
        "confidenceTier": "NONE",
        "warnings": ["dr.v1.insufficient_coverage"],
        "missingInfo": []
      }
    }
  }
]

